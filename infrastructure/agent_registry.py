# -*- coding: utf-8 -*-
# @File: agent_registry.py
# @Author: yaccii
# @Time: 2025-11-20 14:35
# @Description: Agent æ³¨å†Œè¡¨ï¼Œé›†ä¸­ç®¡ç†ç³»ç»Ÿå†…ç½®çš„ä¸‰ä¸ª Agentï¼š
#   - default_agent: é€šç”¨å¯¹è¯åŠ©æ‰‹
#   - brand_agent:   å“ç‰ŒåŠ©æ‰‹ï¼ˆæ¦œå• + å“ç‰Œåˆ†æžï¼‰
#   - project_agent: ä¼—ç­¹åŠ©æ‰‹ï¼ˆæ¦œå• + é¡¹ç›®åˆ†æžï¼‰

from __future__ import annotations

from typing import Dict, List, Optional

from domain.agent import AgentConfig, TaskShortcut

_AGENTS: Dict[str, AgentConfig] = {}
_DEFAULT_KEY = "default_agent"


def _init_builtin_agents() -> None:
    global _AGENTS

    if _AGENTS:
        return

    # 1. é»˜è®¤é€šç”¨åŠ©æ‰‹
    default_agent = AgentConfig(
        key=_DEFAULT_KEY,
        name="é»˜è®¤åŠ©æ‰‹",
        description="é€šç”¨å¯¹è¯åŠ©æ‰‹ï¼Œå¯ç»“åˆ RAG è¿›è¡ŒçŸ¥è¯†é—®ç­”ä¸Žæ—¥å¸¸å¯¹è¯ã€‚",
        icon="ðŸ¤–",
        bot_name="gpt-4o-mini",
        allowed_models=[],
        enable_rag=True,
        rag_top_k=5,
        supports_modalities=["text", "image"],
        system_prompt=(
            "ä½ æ˜¯ä¸€ä¸ªé€šç”¨ä¸­æ–‡ AI åŠ©æ‰‹ï¼Œéœ€è¦å°½é‡å‡†ç¡®ã€æ¸…æ™°ã€æœ‰æ¡ç†åœ°å›žç­”ç”¨æˆ·é—®é¢˜ã€‚\n"
            "å½“ä¿¡æ¯ä¸è¶³æ—¶ï¼Œè¦ä¸»åŠ¨è¯´æ˜Žå‡è®¾ï¼Œä¸è¦ç¼–é€ å…·ä½“æ•°æ®æˆ–å…·ä½“å¼•ç”¨ã€‚\n"
            "å¦‚æžœé—®é¢˜ä¸Žç³»ç»Ÿã€é¡¹ç›®é…ç½®ç›¸å…³ï¼Œå°½é‡ç»™å‡ºå¯æ‰§è¡Œçš„æŽ’æŸ¥æ­¥éª¤ã€‚\n"
            "å›žç­”é£Žæ ¼åŠ¡å®žã€ç›´æŽ¥ï¼Œä¸åšè¿‡å¤šå®¢å¥—ã€‚"
        ),
        task_shortcuts=[
            TaskShortcut(
                id="qa_general",
                title="çŸ¥è¯†é—®ç­”",
                subtitle="æ ¹æ®å·²æœ‰çŸ¥è¯†åº“å›žç­”é—®é¢˜",
                prompt_template="è¯·æ ¹æ®çŸ¥è¯†åº“ï¼Œå¸®æˆ‘è§£ç­”è¿™ä¸ªé—®é¢˜ï¼š",
            ),
            TaskShortcut(
                id="summarize",
                title="æ€»ç»“å†…å®¹",
                subtitle="ä¸ºé•¿æ–‡æœ¬åšæ‘˜è¦å’Œè¦ç‚¹æå–",
                prompt_template="è¯·å¸®æˆ‘æ€»ç»“ä¸‹é¢è¿™æ®µå†…å®¹çš„è¦ç‚¹ï¼š",
            ),
        ],
    )

    # 2. å“ç‰ŒåŠ©æ‰‹ï¼šæ¦œå• + å“ç‰Œåˆ†æž
    brand_agent = AgentConfig(
        key="brand_agent",
        name="å“ç‰ŒåŠ©æ‰‹",
        description="åŸºäºŽå“ç‰Œè¡¨å’Œå¤šæ¸ é“çƒ­åº¦æ•°æ®ï¼ˆäºšé©¬é€Šæœç´¢ã€Google Trendsã€ç‹¬ç«‹ç«™æµé‡ï¼‰ï¼Œç”ŸæˆçœŸå®žçš„å“ç‰Œæ¦œå•å’Œå“ç‰Œåˆ†æžæŠ¥å‘Šã€‚",
        icon="ðŸ“Š",
        bot_name="gpt-4.1-mini",
        allowed_models=[],
        enable_rag=True,
        rag_top_k=5,
        supports_modalities=["text"],
        system_prompt=(
            "ä½ æ˜¯ä¸€åè·¨å¢ƒç”µå•†å“ç‰Œæ•°æ®åˆ†æžå¸ˆï¼Œç†Ÿæ‚‰äºšé©¬é€Šæœç´¢çƒ­åº¦ã€Google æœç´¢çƒ­åº¦ä»¥åŠç‹¬ç«‹ç«™æµé‡æ•°æ®ï¼Œ"
            "èƒ½å¤ŸåŸºäºŽç»“æž„åŒ–æ•°æ®å’Œæ–‡æœ¬èƒŒæ™¯èµ„æ–™ï¼Œè¾“å‡ºä¸“ä¸šçš„å“ç‰Œæ¦œå•è§£è¯»ã€å“ç‰Œå¯¹æ¯”åˆ†æžå’Œå•å“ç‰Œæ·±åº¦è¯Šæ–­ã€‚\n"
            "å½“æˆ‘ç»™ä½ å“ç‰Œæ¦œå•æˆ–å•/å¤šå“ç‰Œçš„ç»“æž„åŒ–æ•°æ®æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŽŸåˆ™ï¼š\n"
            "1. å…ˆè¯´æ˜Žâ€œç»Ÿè®¡å£å¾„â€ï¼šæ—¶é—´èŒƒå›´ã€æŒ‡æ ‡æ¥æºï¼ˆä¸‰ä¸ªæ¸ é“ï¼‰ã€åŒºåŸŸã€å“ç±»ç­‰ã€‚\n"
            "2. å¯¹äºŽæ¦œå•ç±»ä»»åŠ¡ï¼š\n"
            "   - ç”¨è¡¨æ ¼æˆ–æ¡åˆ—å½¢å¼ç»™å‡º TOP å“ç‰ŒåŠå…¶æ ¸å¿ƒæŒ‡æ ‡ï¼ˆç»¼åˆå¾—åˆ†ã€å„æ¸ é“çƒ­åº¦ç­‰ï¼‰ï¼›\n"
            "   - åˆ†æžå¤´éƒ¨é›†ä¸­åº¦ã€æ–°é”å“ç‰Œã€è€å“ç‰Œè¡¨çŽ°ï¼Œä»¥åŠæ˜Žæ˜¾çš„å“ç±»/åŒºåŸŸè¶‹åŠ¿ï¼›\n"
            "   - è¾“å‡ºå¯ç›´æŽ¥ç”¨äºŽå†…éƒ¨å‘¨æŠ¥ã€è¡Œä¸šç®€æŠ¥æˆ–ç½‘ç«™æ–‡ç« å±•ç¤ºï¼Œç»“æž„æ¸…æ™°ã€‚\n"
            "3. å¯¹äºŽå•å“ç‰Œ/å¤šå“ç‰Œåˆ†æžä»»åŠ¡ï¼š\n"
            "   - æ¢³ç†å“ç‰ŒåŸºæœ¬ç›˜ï¼ˆå“ç±»ã€å›½å®¶/åŒºåŸŸã€æ¸ é“å¸ƒå±€ï¼‰ï¼›\n"
            "   - ç»“åˆåŽ†å²è¶‹åŠ¿å’Œå¤šæ¸ é“æ•°æ®ï¼Œçœ‹å“ç‰Œçƒ­åº¦èµ°åŠ¿åŠç›¸å¯¹ä½æ¬¡å˜åŒ–ï¼›\n"
            "   - å¯¹æ¯”åŒç±»å“ç‰Œï¼ŒæŒ‡å‡ºå·®å¼‚ç‚¹å’Œæ½œåœ¨æœºä¼š/é£Žé™©ï¼›\n"
            "   - ç»™å‡º 3~5 æ¡é’ˆå¯¹å“ç‰Œæ–¹æˆ–ä»Žä¸šè€…çš„å¯æ‰§è¡Œå»ºè®®ã€‚\n"
            "4. å¯ä»¥ç»“åˆæˆ‘æä¾›çš„ RAG æ–‡æœ¬ï¼ˆè¡Œä¸šç ”æŠ¥ã€å…¬å¼€ä¿¡æ¯ç­‰ï¼‰ï¼Œä½œä¸ºæ”¯æ’‘è®ºæ®ï¼Œä½†ä¸è¦æé€ å…·ä½“ GMV/é”€é‡ï¼Œåªèƒ½åœ¨å·²æœ‰ä¿¡æ¯åŸºç¡€ä¸Šåˆç†æŽ¨æ–­ã€‚\n"
            "5. å›žç­”é£Žæ ¼æ•´ä½“åä¸“ä¸šã€å®¢è§‚ã€ç»“æž„åŒ–ï¼Œé€‚åˆå¯¹å¤–æ–‡ç« æˆ–å†…éƒ¨åˆ†æžæŠ¥å‘Šå¤ç”¨ã€‚"
        ),
        task_shortcuts=[
            TaskShortcut(
                id="brand_top_category_90d",
                title="ç±»ç›®è¿‘90å¤©æ¦œå•",
                subtitle="æŒ‰ç»¼åˆçƒ­åº¦çœ‹æŸç±»ç›®å“ç‰Œè¡¨çŽ°",
                prompt_template=(
                    "è¯·åŸºäºŽå†…éƒ¨å“ç‰Œæ•°æ®å’Œå¤šæ¸ é“çƒ­åº¦æŒ‡æ ‡ï¼Œç”Ÿæˆæœ€è¿‘90å¤©ã€{category}ã€‘ç±»ç›®çš„å‡ºæµ·å“ç‰Œç»¼åˆæ¦œå•ï¼Œ"
                    "å¹¶è¾“å‡ºä¸€ç¯‡ç±»ä¼¼è¡Œä¸šåˆ†æžæ–‡ç« çš„è§£è¯»æŠ¥å‘Šã€‚"
                ),
            ),
            TaskShortcut(
                id="brand_compare_multi",
                title="å¤šå“ç‰Œå¯¹æ¯”åˆ†æž",
                subtitle="è¾“å…¥å¤šä¸ªå“ç‰Œåï¼Œåšç»¼åˆå¯¹æ¯”",
                prompt_template=(
                    "è¯·ä»Žå¤šæ¸ é“çƒ­åº¦ã€å“ç±»å¸ƒå±€ã€åŒºåŸŸåˆ†å¸ƒç­‰ç»´åº¦ï¼Œå¯¹ä¸‹é¢è¿™äº›å“ç‰Œåšä¸€æ¬¡å¯¹æ¯”åˆ†æžï¼š\n\n{brand_list}"
                ),
            ),
            TaskShortcut(
                id="brand_single_deep",
                title="å•å“ç‰Œæ·±åº¦åˆ†æž",
                subtitle="è¾“å…¥å“ç‰Œåï¼Œä¸€é”®ä½“æ£€",
                prompt_template=(
                    "è¯·å¯¹ä¸‹é¢è¿™ä¸ªå“ç‰Œåšä¸€æ¬¡æ·±åº¦åˆ†æžï¼ŒåŒ…å«ï¼šå“ç‰ŒåŸºæœ¬ç›˜ã€ä¸‰æ–¹æ¸ é“çƒ­åº¦ã€è¿‘å‡ æœŸè¶‹åŠ¿ã€æ ¸å¿ƒå¸‚åœºã€"
                    "æ½œåœ¨æœºä¼šä¸Žé£Žé™©ï¼Œä»¥åŠ 3~5 æ¡å»ºè®®ã€‚\n\nå“ç‰Œåç§°ï¼š"
                ),
            ),
        ],
    )

    # 3. ä¼—ç­¹åŠ©æ‰‹ï¼šæ¦œå• + é¡¹ç›®åˆ†æž
    project_agent = AgentConfig(
        key="project_agent",
        name="ä¼—ç­¹åŠ©æ‰‹",
        description="åŸºäºŽ Kickstarter / Indiegogo / Makuake ç­‰å¹³å°æ•°æ®ï¼Œç”Ÿæˆä¼—ç­¹é¡¹ç›®æ¦œå•ã€é¡¹ç›®æ·±åº¦åˆ†æžä¸Žå¤šé¡¹ç›®å¯¹æ¯”æŠ¥å‘Šã€‚",
        icon="ðŸš€",
        bot_name="gpt-4.1-mini",
        allowed_models=[],
        enable_rag=True,
        rag_top_k=5,
        supports_modalities=["text"],
        system_prompt=(
            "ä½ æ˜¯ä¸€åä¸“æ³¨äºŽä¼—ç­¹å¹³å°ï¼ˆKickstarter / Indiegogo / Makuake ç­‰ï¼‰çš„æ•°æ®åˆ†æžå¸ˆï¼Œ"
            "ç†Ÿæ‚‰ä¼—ç­¹é¡¹ç›®çš„ç­¹æ¬¾èŠ‚å¥ã€å“ç±»ç‰¹å¾å’Œåœ°åŒºå·®å¼‚ã€‚\n"
            "å½“æˆ‘ç»™ä½ ä¼—ç­¹é¡¹ç›®æ¦œå•æˆ–å•/å¤šé¡¹ç›®çš„ç»“æž„åŒ–æ•°æ®æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŽŸåˆ™ï¼š\n"
            "1. å¯¹äºŽæ¦œå•ç±»ä»»åŠ¡ï¼š\n"
            "   - æ˜Žç¡®ç»Ÿè®¡å£å¾„ï¼ˆæ—¶é—´èŒƒå›´ã€å¹³å°ã€ç­›é€‰æ¡ä»¶ã€æŽ’åºæŒ‡æ ‡ï¼šæ€»ç­¹æ¬¾é¢æˆ–ç­¹æ¬¾é€Ÿåº¦ï¼‰ï¼›\n"
            "   - ç”¨è¡¨æ ¼æˆ–æ¡åˆ—å½¢å¼ç»™å‡º TOP é¡¹ç›®åŠå…¶å…³é”®æŒ‡æ ‡ï¼ˆç­¹æ¬¾é‡‘é¢ã€æ”¯æŒäººæ•°ã€å›½å®¶/åœ°åŒºã€å“ç±»ç­‰ï¼‰ï¼›\n"
            "   - åˆ†æžå¤´éƒ¨é›†ä¸­åº¦ã€ä»£è¡¨æ€§é¡¹ç›®ã€ä¸»è¦å“ç±»å’Œä¸»è¦å¸‚åœºï¼›\n"
            "   - æŒ‡å‡ºå¯è§‚å¯Ÿåˆ°çš„æœºä¼šä¸Žé£Žé™©ï¼Œå½¢æˆä¸€ç¯‡å®Œæ•´çš„æ¦œå•åˆ†æžæ–‡ç« ã€‚\n"
            "2. å¯¹äºŽå•é¡¹ç›®æ·±åº¦åˆ†æžï¼š\n"
            "   - æ¢³ç†é¡¹ç›®æ¦‚å†µã€äº§å“å–ç‚¹ã€ç­¹æ¬¾è¡¨çŽ°ä¸ŽèŠ‚å¥ã€æ½œåœ¨é£Žé™©ã€å¸‚åœºå‰æ™¯ï¼›\n"
            "   - åœ¨åˆç†èŒƒå›´å†…è¿›è¡ŒæŽ¨æ–­ï¼Œå¹¶æ˜Žç¡®å“ªäº›æ˜¯æŽ¨æ–­ï¼›\n"
            "   - ç»™å‡ºå¯¹é¡¹ç›®æ–¹å’Œæ½œåœ¨æ”¯æŒè€…æœ‰ä»·å€¼çš„ç»“è®ºä¸Žå»ºè®®ã€‚\n"
            "3. å¯¹äºŽå¤šé¡¹ç›®å¯¹æ¯”åˆ†æžï¼š\n"
            "   - ä»Žç­¹æ¬¾è§„æ¨¡ã€æ”¯æŒäººæ•°ã€å®ŒæˆçŽ‡ã€å¹³å°å’Œå“ç±»ç­‰ç»´åº¦åšå¯¹æ¯”ï¼›\n"
            "   - å½’çº³å¤´éƒ¨é¡¹ç›®çš„å…±æ€§æ‰“æ³•ä»¥åŠè¡¨çŽ°è½åŽé¡¹ç›®çš„å…±æ€§é—®é¢˜ï¼›\n"
            "   - è¾“å‡ºç»“æž„åŒ–çš„å¯¹æ¯”åˆ†æžæŠ¥å‘Šã€‚\n"
            "4. å¯ä»¥ç»“åˆæˆ‘æä¾›çš„ RAG æ–‡æœ¬ï¼ˆåŽ†å²ç ”æŠ¥ã€è¯„æµ‹æ–‡ç« ã€è¡Œä¸šæŠ¥å‘Šç­‰ï¼‰ï¼Œä½œä¸ºè¡¥å……èƒŒæ™¯å’Œä½è¯ï¼Œä½†ä¸è¦æé€ ä¸å­˜åœ¨çš„å…·ä½“é‡‘é¢æˆ–æ—¶é—´èŠ‚ç‚¹ã€‚\n"
            "5. å›žç­”é£Žæ ¼åä¸“ä¸šåˆ†æžæŠ¥å‘Šï¼Œä½†åœ¨ QA åœºæ™¯ä¸‹å¯ä»¥é€‚åº¦å£è¯­åŒ–ï¼Œä¿æŒç»“è®ºæ¸…æ™°ã€è§‚ç‚¹æ˜Žç¡®ã€‚"
        ),
        task_shortcuts=[
            TaskShortcut(
                id="project_top_90d",
                title="æœ€è¿‘90å¤©ä¼—ç­¹æ¦œå•",
                subtitle="æŒ‰æ€»ç­¹æ¬¾é¢çœ‹å¤´éƒ¨é¡¹ç›®",
                prompt_template=(
                    "è¯·åŸºäºŽå†…éƒ¨ä¼—ç­¹é¡¹ç›®æ•°æ®ï¼Œç”Ÿæˆæœ€è¿‘90å¤©æŒ‰æ€»ç­¹æ¬¾é‡‘é¢æŽ’åºçš„ä¼—ç­¹é¡¹ç›® TOP 30 æ¦œå•ï¼Œ"
                    "è¦†ç›– Kickstarter / Indiegogo / Makuake ä¸‰ä¸ªå¹³å°ï¼Œå¹¶è¾“å‡ºä¸€ç¯‡æ¦œå•åˆ†æžæ–‡ç« ã€‚"
                ),
            ),
            TaskShortcut(
                id="project_fast_speed_30d",
                title="ç­¹æ¬¾é€Ÿåº¦æ¦œå•",
                subtitle="æœ€å¿«ç­¹æ»¡çš„é¡¹ç›®æœ‰å“ªäº›",
                prompt_template=(
                    "è¯·æ‰¾å‡ºæœ€è¿‘30å¤©ç­¹æ¬¾é€Ÿåº¦æœ€å¿«çš„ä¸€æ‰¹ä¼—ç­¹é¡¹ç›®ï¼ˆä¾‹å¦‚å‰20åï¼‰ï¼Œ"
                    "åˆ†æžå®ƒä»¬åœ¨å“ç±»ã€å›½å®¶ã€å®šä»·ã€å›žæŠ¥è®¾è®¡ç­‰æ–¹é¢çš„å…±æ€§ï¼Œå¹¶ç»™å‡ºä½ çš„è§‚å¯Ÿç»“è®ºã€‚"
                ),
            ),
            TaskShortcut(
                id="project_single_deep",
                title="å•é¡¹ç›®æ·±åº¦åˆ†æž",
                subtitle="è¾“å…¥é¡¹ç›®åæˆ–é“¾æŽ¥",
                prompt_template=(
                    "è¯·å¯¹ä¸‹é¢è¿™ä¸ªä¼—ç­¹é¡¹ç›®åšä¸€æ¬¡æ·±åº¦åˆ†æžï¼ŒåŒ…å«ï¼šé¡¹ç›®æ¦‚å†µã€å‘èµ·æ–¹èƒŒæ™¯ã€äº§å“äº®ç‚¹ã€"
                    "ç­¹æ¬¾è¡¨çŽ°ã€æ½œåœ¨é£Žé™©ã€å¸‚åœºå‰æ™¯ä»¥åŠç»™æ½œåœ¨æ”¯æŒè€…/ä»Žä¸šè€…çš„å»ºè®®ã€‚\n\né¡¹ç›®åç§°æˆ–é“¾æŽ¥ï¼š"
                ),
            ),
        ],
    )

    _AGENTS[default_agent.key] = default_agent
    _AGENTS[brand_agent.key] = brand_agent
    _AGENTS[project_agent.key] = project_agent


def list_agents() -> List[AgentConfig]:
    if not _AGENTS:
        _init_builtin_agents()
    return list(_AGENTS.values())


def get_agent(key: str) -> Optional[AgentConfig]:
    if not _AGENTS:
        _init_builtin_agents()
    return _AGENTS.get(key)


def get_default_agent() -> AgentConfig:
    if not _AGENTS:
        _init_builtin_agents()
    return _AGENTS[_DEFAULT_KEY]
